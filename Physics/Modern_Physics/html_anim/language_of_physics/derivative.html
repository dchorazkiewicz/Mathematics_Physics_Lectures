<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wizualizacja Pochodnych</title>
    <!-- Import Plotly -->
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            background-color: #f4f4f4;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
        }

        .derivative-widget {
            width: 100%;
            max-width: 1000px;
            margin: 20px;
            padding: 10px;
            background-color: #f4f4f4;
            color: #333;
            display: flex;
            flex-direction: column;
            align-items: center;
            border-radius: 8px;
        }

        .derivative-widget .vis-container {
            width: 100%;
            background-color: white;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            height: 650px;
        }

        /* Tabs styling */
        .derivative-widget .tabs {
            display: flex;
            background-color: #e0e0e0;
            border-radius: 8px 8px 0 0;
        }

        .derivative-widget .tab-btn {
            flex: 1;
            padding: 15px;
            border: none;
            background-color: transparent;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: background-color 0.3s;
            border-bottom: 3px solid transparent;
        }

        .derivative-widget .tab-btn:hover {
            background-color: #d0d0d0;
        }

        .derivative-widget .tab-btn.active {
            background-color: white;
            border-bottom: 3px solid #1976d2;
            color: #1976d2;
        }

        /* Content styling */
        .derivative-widget .tab-content {
            display: none;
            flex: 1;
            padding: 20px;
            flex-direction: column;
            overflow: hidden;
        }

        .derivative-widget .tab-content.active {
            display: flex;
        }

        .derivative-widget .controls {
            display: flex;
            gap: 20px;
            margin-bottom: 15px;
            align-items: center;
            flex-wrap: wrap;
            padding: 15px;
            background-color: #f9f9f9;
            border-radius: 8px;
            border: 1px solid #eee;
            justify-content: space-between; /* Rozsunięcie elementów */
        }

        .derivative-widget .control-group {
            display: flex;
            flex-direction: column;
            min-width: 150px;
        }

        /* Styl dla boksu z wynikami */
        .derivative-widget .result-box {
            background-color: #fff;
            padding: 10px 15px;
            border-radius: 6px;
            border-left: 4px solid #1976d2;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            min-width: 220px;
        }

        .derivative-widget label {
            font-size: 0.9em;
            font-weight: 600;
            margin-bottom: 5px;
            color: #555;
        }

        .derivative-widget input[type=range] {
            cursor: pointer;
        }

        .derivative-widget .plot-area {
            flex: 1;
            width: 100%;
            min-height: 400px;
            position: relative;
        }

        .derivative-widget .math-val {
            font-family: monospace;
            color: #d32f2f;
            font-weight: bold;
        }

        .derivative-widget .math-result {
            font-family: monospace;
            color: #1976d2;
            font-weight: bold;
            font-size: 1.2em;
        }
    </style>
</head>
<body>

<div class="derivative-widget">
    <div class="vis-container">
        <div class="tabs">
            <button class="tab-btn active" data-tab="ordinary">Ordinary Derivative (1D)</button>
            <button class="tab-btn" data-tab="partial">Partial Derivatives (2D/3D)</button>
        </div>

        <div id="tab-ordinary" class="tab-content active">
            <div class="controls">
                <div style="display:flex; gap: 20px; flex-wrap: wrap;">
                    <div class="control-group">
                        <label>Point position (x): <span id="ord-x-val" class="math-val">1.00</span></label>
                        <input type="range" id="ord-x" min="-2.5" max="2.5" step="0.05" value="1.0">
                    </div>
                    <div class="control-group">
                        <label>Step size (h): <span id="ord-h-val" class="math-val">1.00</span></label>
                        <input type="range" id="ord-h" min="0.01" max="2.0" step="0.01" value="1.0">
                    </div>
                </div>

                <!-- Boks z obliczeniami -->
                <div class="control-group result-box">
                    <div title="Iloraz różnicowy (nachylenie siecznej)">
                        &Delta;y / &Delta;x &approx; <span id="calc-slope" class="math-result"></span>
                    </div>
                    <div style="font-size: 0.85em; color: #666; margin-top: 4px;">
                        Exact derivative f'(x): <span id="calc-exact" style="font-weight:600"></span>
                    </div>
                </div>

                <div style="width: 100%; font-size: 0.85em; color: #666; margin-top: 10px;">
                    Function: <span style="font-family: monospace">f(x) = 0.5x³ - x</span><br>
                    Move 'h' close to 0 to see the approximation converge to the exact value.
                </div>
            </div>
            <div id="plot-ordinary" class="plot-area"></div>
        </div>

        <div id="tab-partial" class="tab-content">
            <div class="controls">
                <div class="control-group">
                    <label>X position: <span id="part-x-val" class="math-val">1.00</span></label>
                    <input type="range" id="part-x" min="-2.5" max="2.5" step="0.1" value="1.0">
                </div>
                <div class="control-group">
                    <label>Y position: <span id="part-y-val" class="math-val">1.00</span></label>
                    <input type="range" id="part-y" min="-2.5" max="2.5" step="0.1" value="1.0">
                </div>
                <div style="font-size: 0.85em; color: #666;">
                    Function: <span style="font-family: monospace">f(x,y) = sin(x) * cos(y)</span><br>
                    <span style="color:red">Red:</span> Slice y=const (∂f/∂x).
                    <span style="color:blue">Blue:</span> Slice x=const (∂f/∂y).
                </div>
            </div>
            <div id="plot-partial" class="plot-area"></div>
        </div>
    </div>
</div>

<script>
    (function() {
        const widget = document.querySelector('.derivative-widget');

        function switchTab(tabName) {
            widget.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            widget.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));

            widget.querySelector('#tab-' + tabName).classList.add('active');
            widget.querySelector(`.tab-btn[data-tab="${tabName}"]`).classList.add('active');

            window.dispatchEvent(new Event('resize'));
        }

        widget.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                switchTab(this.getAttribute('data-tab'));
            });
        });

        // --- TAB 1 LOGIC: ORDINARY DERIVATIVE ---
        const ordXSlider = document.getElementById('ord-x');
        const ordHSlider = document.getElementById('ord-h');
        const ordXVal = document.getElementById('ord-x-val');
        const ordHVal = document.getElementById('ord-h-val');

        // Elementy do wyświetlania obliczeń
        const calcSlope = document.getElementById('calc-slope');
        const calcExact = document.getElementById('calc-exact');

        function f1(x) { return 0.5 * Math.pow(x, 3) - x; }
        function df1(x) { return 1.5 * Math.pow(x, 2) - 1; }

        function drawOrdinary() {
            const x0 = parseFloat(ordXSlider.value);
            const h = parseFloat(ordHSlider.value);
            const x1 = x0 + h;

            ordXVal.innerText = x0.toFixed(2);
            ordHVal.innerText = h.toFixed(2);

            const xRange = [], yRange = [];
            for (let i = -3.5; i <= 3.5; i += 0.1) {
                xRange.push(i);
                yRange.push(f1(i));
            }
            const y0 = f1(x0);
            const y1 = f1(x1);

            // Secant calculation (Difference Quotient)
            const m_secant = (y1 - y0) / (x1 - x0);

            // Tangent calculation (Exact Derivative)
            const m_tangent = df1(x0);

            // Aktualizacja wyświetlacza obliczeń
            calcSlope.innerText = m_secant.toFixed(4);
            calcExact.innerText = m_tangent.toFixed(4);

            const secantX = [x0 - 2, x1 + 2];
            const secantY = [m_secant * (secantX[0] - x0) + y0, m_secant * (secantX[1] - x0) + y0];

            const tangentX = [x0 - 1.5, x0 + 1.5];
            const tangentY = [m_tangent * (tangentX[0] - x0) + y0, m_tangent * (tangentX[1] - x0) + y0];

            const triX = [x0, x1, x1, x0];
            const triY = [y0, y0, y1, y0];

            const data = [
                { x: xRange, y: yRange, mode: 'lines', line: {color: '#444', width: 2}, name: 'f(x)' },
                { x: triX, y: triY, mode: 'lines', line: {color: 'rgba(0,0,0,0.3)', width: 1, dash: 'dot'}, fill: 'toself', fillColor: 'rgba(0,255,0,0.1)', name: 'Δx, Δy', showlegend: false },
                { x: secantX, y: secantY, mode: 'lines', line: {color: '#2e7d32', width: 3}, name: 'Secant (Approx)' },
                { x: tangentX, y: tangentY, mode: 'lines', line: {color: '#d32f2f', width: 2, dash: 'dash'}, name: 'Tangent (Exact)' },
                { x: [x0], y: [y0], mode: 'markers', marker: {color: '#d32f2f', size: 10}, name: 'x' },
                { x: [x1], y: [y1], mode: 'markers', marker: {color: '#2e7d32', size: 10}, name: 'x + h' }
            ];

            const layout = {
                title: 'Difference Quotient vs Derivative',
                xaxis: {title: 'x', range: [-3, 3]},
                yaxis: {title: 'f(x)', range: [-3, 3]},
                margin: {l: 50, r: 20, t: 40, b: 40},
                showlegend: true,
                legend: {x: 0, y: 1},
                autosize: true
            };

            // Używamy react dla płynności
            Plotly.react('plot-ordinary', data, layout, {responsive: true, displayModeBar: false});
        }

        ordXSlider.addEventListener('input', drawOrdinary);
        ordHSlider.addEventListener('input', drawOrdinary);


        // --- TAB 2 LOGIC: PARTIAL DERIVATIVES ---
        const partXSlider = document.getElementById('part-x');
        const partYSlider = document.getElementById('part-y');
        const partXVal = document.getElementById('part-x-val');
        const partYVal = document.getElementById('part-y-val');

        function f2(x, y) { return Math.sin(x) * Math.cos(y); }
        function df2_dx(x, y) { return Math.cos(x) * Math.cos(y); }
        function df2_dy(x, y) { return -Math.sin(x) * Math.sin(y); }

        function drawPartial() {
            const x0 = parseFloat(partXSlider.value);
            const y0 = parseFloat(partYSlider.value);
            const z0 = f2(x0, y0);

            partXVal.innerText = x0.toFixed(2);
            partYVal.innerText = y0.toFixed(2);

            const range = 3.5;
            const step = 0.2;
            const z_data = [], x_axis = [], y_axis = [];
            for (let y = -range; y <= range; y += step) {
                const row = [];
                y_axis.push(y);
                for (let x = -range; x <= range; x += step) {
                    if(y === -range) x_axis.push(x);
                    row.push(f2(x, y));
                }
                z_data.push(row);
            }

            const sliceX_x=[], sliceX_y=[], sliceX_z=[];
            for(let i=-range; i<=range; i+=0.1) { sliceX_x.push(i); sliceX_y.push(y0); sliceX_z.push(f2(i, y0)); }

            const sliceY_x=[], sliceY_y=[], sliceY_z=[];
            for(let i=-range; i<=range; i+=0.1) { sliceY_x.push(x0); sliceY_y.push(i); sliceY_z.push(f2(x0, i)); }

            const slopeX = df2_dx(x0, y0);
            const tanX_x = [x0 - 1, x0 + 1], tanX_y = [y0, y0], tanX_z = [z0 - slopeX, z0 + slopeX];

            const slopeY = df2_dy(x0, y0);
            const tanY_x = [x0, x0], tanY_y = [y0 - 1, y0 + 1], tanY_z = [z0 - slopeY, z0 + slopeY];

            const data = [
                { z: z_data, x: x_axis, y: y_axis, type: 'surface', colorscale: 'Viridis', opacity: 0.6, showscale: false, name: 'Surface' },
                { type: 'scatter3d', mode: 'lines', x: sliceX_x, y: sliceX_y, z: sliceX_z, line: {width: 5, color: 'red'}, name: 'Cut y=const' },
                { type: 'scatter3d', mode: 'lines', x: tanX_x, y: tanX_y, z: tanX_z, line: {width: 8, color: '#ff8a80'}, name: 'Tangent X' },
                { type: 'scatter3d', mode: 'lines', x: sliceY_x, y: sliceY_y, z: sliceY_z, line: {width: 5, color: 'blue'}, name: 'Cut x=const' },
                { type: 'scatter3d', mode: 'lines', x: tanY_x, y: tanY_y, z: tanY_z, line: {width: 8, color: '#82b1ff'}, name: 'Tangent Y' },
                { type: 'scatter3d', mode: 'markers', x: [x0], y: [y0], z: [z0], marker: {size: 6, color: 'black'}, name: 'Point P' }
            ];

            const layout = {
                title: 'Partial Derivatives (Slices)',
                margin: {l: 0, r: 0, b: 0, t: 30},
                scene: { aspectmode: 'cube', xaxis: {title: 'X'}, yaxis: {title: 'Y'}, zaxis: {title: 'Z'} },
                showlegend: true,
                legend: {x: 0, y: 1},
                autosize: true
            };
            Plotly.react('plot-partial', data, layout, {responsive: true, displayModeBar: false});
        }

        partXSlider.addEventListener('input', drawPartial);
        partYSlider.addEventListener('input', drawPartial);

        drawOrdinary();
        setTimeout(drawPartial, 100);

        window.addEventListener('resize', () => {
            Plotly.Plots.resize('plot-ordinary');
            Plotly.Plots.resize('plot-partial');
        });
    })();
</script>

</body>
</html>